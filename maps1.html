<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sikkim Monasteries Map</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v10.1.0/ol.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }
      body {
        font-family: "Inter", sans-serif;
        color: #333;
        line-height: 1.6;
        overflow: hidden;
        background-color: #f0f2f5; /* Add a light background */
      }
      .nav-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }
      .nav-brand {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 1.2rem;
      }
      .brand-icon {
        margin-right: 8px;
        font-size: 1.8rem;
      }
      .back-button {
        background-color: #3a6ea5;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s ease;
      }
      .back-button:hover {
        background-color: #2a4e7a;
        transform: translateY(-2px);
      }
      .map-container {
        position: fixed;
        top: 60px; /* Adjusted for the new nav bar */
        left: 0;
        right: 0;
        bottom: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .map-overlay {
        position: absolute;
        top: 20px;
        right: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        z-index: 1;
        max-width: 320px;
        max-height: 80vh;
        overflow-y: auto;
        font-size: 14px;
      }
      .map-overlay h2 {
        margin-bottom: 12px;
        color: #3a6ea5;
        font-size: 1.3rem;
      }
      .map-overlay p {
        margin-bottom: 12px;
        color: #666;
        line-height: 1.5;
      }
      .monastery-list {
        margin-top: 15px;
      }
      .monastery-item {
        padding: 12px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 6px;
      }
      .monastery-item:hover {
        background-color: #f5f7fa;
      }
      .monastery-name {
        font-weight: 600;
        color: #3a6ea5;
        margin-bottom: 4px;
      }
      .monastery-location {
        font-size: 12px;
        color: #888;
        display: flex;
        justify-content: space-between;
      }
      .map-controls {
        position: absolute;
        bottom: 20px;
        left: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 1;
      }
      .map-btn {
        background-color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        font-family: "Inter", sans-serif;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
      }
      .map-btn:hover {
        background-color: #f5f7fa;
        transform: translateY(-2px);
      }
      /* Dropdown Styles */
      .map-style-dropdown {
        position: absolute;
        top: 80px; /* moved down from very top for desktop and mobile */
        left: 20px;
        z-index: 10; /* higher z-index for visibility */
        width: 180px; /* fixed width */
      }

      select {
        background: white;
        border-radius: 8px;
        border: 1px solid #ccc;
        padding: 8px 12px;
        font-family: "Inter", sans-serif;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }
      select:hover {
        border-color: #3a6ea5;
      }
      /* Beautiful Popup Styles */
      .popup-content {
        background: white;
        width: 280px;
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        opacity: 0;
        transform: scale(0.9);
        animation: fadeInUp 0.3s forwards;
        font-family: "Inter", sans-serif;
      }
      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .popup-header {
        background: linear-gradient(135deg, #3a6ea5 0%, #2a4e7a 100%);
        color: white;
        padding: 16px 20px;
        font-size: 1.1rem;
        font-weight: 600;
      }
      .popup-body {
        padding: 16px 20px;
        color: #444;
        font-size: 0.9rem;
        line-height: 1.5;
      }
      .popup-body p {
        margin-bottom: 8px;
      }
      .popup-body strong {
        color: #2d3748;
      }
      .popup-button {
        background-color: #3a6ea5;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 6px;
        width: 100%;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        margin-top: 10px;
        transition: all 0.2s ease;
      }
      .popup-button:hover {
        background-color: #2a4e7a;
        transform: translateY(-1px);
      }
      .zoom-info {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 8px 12px;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        z-index: 1;
      }
      .toggle-sidebar {
        position: absolute;
        top: 20px;
        right: 350px;
        background: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 2;
        transition: all 0.3s ease;
      }
      .toggle-sidebar:hover {
        transform: scale(1.1);
      }
      .location-info {
        position: absolute;
        top: 20px;
        left: 20px;
        background: white;
        padding: 12px 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 1;
        max-width: 250px;
        font-size: 14px;
        display: none;
      }
      .location-info.active {
        display: block;
      }
      .location-status {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }
      .pulse-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: #4caf50;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
        }
        70% {
          transform: scale(1);
          box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
        }
      }

      @media (max-width: 992px) {
        .map-style-dropdown {
          top: 60px; /* slightly closer to top for smaller screens */
          left: 10px;
          width: 160px; /* smaller width for mobile */
        }
        select {
          width: 100%;
          font-size: 16px; /* larger font for better touch target */
        }
      }

      @media (max-width: 576px) {
        .map-overlay h2 {
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <div class="nav-container">
      <div class="nav-brand">
        <span class="brand-icon">üèõ</span>
        <span>Monastery360 - Sikkim</span>
      </div>
      <a href="index.html" class="back-button">&larr; Back to Home</a>
    </div>
    <!-- Map Container -->
    <div class="map-container">
      <div id="map"></div>
      <!-- Map Style Dropdown -->
      <div class="map-style-dropdown">
        <select id="mapStyleSelect" aria-label="Select map style">
          <option value="satellite" selected>Satellite</option>
          <option value="streets">Streets</option>
          <option value="winter">Winter</option>
          <option value="topo">Topographic</option>
          <option value="landscape">Landscape</option>
        </select>
      </div>
      <!-- Location Info Panel -->
      <div class="location-info" id="locationInfo">
        <div class="location-status">
          <div class="pulse-dot"></div>
          <strong>Live Location</strong>
        </div>
        <div id="locationDetails">Acquiring your location...</div>
        <button
          class="map-btn"
          style="margin-top: 10px; padding: 5px 10px; font-size: 12px"
          onclick="stopLocationTracking()"
        >
          Stop Tracking
        </button>
      </div>
      <!-- Sidebar Overlay -->
      <div class="map-overlay" id="sidebar">
        <h2>Sikkim Monasteries</h2>
        <p>
          Explore the sacred monasteries of Sikkim. Click on markers for
          details.
        </p>
        <div class="monastery-list">
          <div
            class="monastery-item"
            onclick="focusOnMonastery([88.5715, 27.3005], 'Rumtek Monastery', this)"
          >
            <div class="monastery-name">Rumtek Monastery</div>
            <div class="monastery-location">
              <span>East Sikkim</span>
              <span>16th Century</span>
            </div>
          </div>
          <div
            class="monastery-item"
            onclick="focusOnMonastery([88.2550, 27.3000], 'Pemayangtse Monastery', this)"
          >
            <div class="monastery-name">Pemayangtse Monastery</div>
            <div class="monastery-location">
              <span>West Sikkim</span>
              <span>17th Century</span>
            </div>
          </div>
          <div
            class="monastery-item"
            onclick="focusOnMonastery([88.2833, 27.3667], 'Tashiding Monastery', this)"
          >
            <div class="monastery-name">Tashiding Monastery</div>
            <div class="monastery-location">
              <span>West Sikkim</span>
              <span>17th Century</span>
            </div>
          </div>
          <div
            class="monastery-item"
            onclick="focusOnMonastery([88.6119, 27.3414], 'Enchey Monastery', this)"
          >
            <div class="monastery-name">Enchey Monastery</div>
            <div class="monastery-location">
              <span>East Sikkim</span>
              <span>19th Century</span>
            </div>
          </div>
          <div
            class="monastery-item"
            onclick="focusOnMonastery([88.3897, 27.3242], 'Dubdi Monastery', this)"
          >
            <div class="monastery-name">Dubdi Monastery</div>
            <div class="monastery-location">
              <span>West Sikkim</span>
              <span>17th Century</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Toggle Sidebar Button -->
      <div class="toggle-sidebar" onclick="toggleSidebar()">‚óÄ</div>
      <!-- Map Controls -->
      <div class="map-controls">
        <button class="map-btn" onclick="zoomIn()">üîç Zoom In</button>
        <button class="map-btn" onclick="zoomOut()">üîç Zoom Out</button>
        <button class="map-btn" onclick="resetView()">üó∫ Reset View</button>
        <button class="map-btn" onclick="locateUser()">üìç My Location</button>
      </div>
      <!-- Zoom Info -->
      <div class="zoom-info">Zoom: <span id="zoom-level">9</span></div>
    </div>
    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.1.0/dist/ol.js"></script>
    <script>
      const key = "tuMq8S306tz9OL24y4jc";
      const mapStyles = {
        satellite: `https://api.maptiler.com/maps/satellite/{z}/{x}/{y}@2x.jpg?key=${key}`,
        streets: `https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}@2x.png?key=${key}`,
        winter: `https://api.maptiler.com/maps/winter-v2/{z}/{x}/{y}@2x.png?key=${key}`,
        topo: `https://api.maptiler.com/maps/topo-v2/{z}/{x}/{y}@2x.png?key=${key}`,
        landscape: `https://api.maptiler.com/maps/landscape/{z}/{x}/{y}@2x.png?key=${key}`,
      };
      const monasteries = [
        {
          name: "Rumtek Monastery",
          lngLat: [88.5715, 27.3005],
          description:
            "One of the largest and most significant monasteries in Sikkim, also known as the Dharma Chakra Centre.",
          location: "East Sikkim",
          century: "16th Century",
        },
        {
          name: "Pemayangtse Monastery",
          lngLat: [88.255, 27.3],
          description:
            "A premier monastery known for its intricate sculptures and paintings. Offers stunning views of the Himalayan ranges.",
          location: "West Sikkim",
          century: "17th Century",
        },
        {
          name: "Tashiding Monastery",
          lngLat: [88.2833, 27.3667],
          description:
            "One of the holiest monasteries in Sikkim, believed to cleanse sins just by seeing it.",
          location: "West Sikkim",
          century: "17th Century",
        },
        {
          name: "Enchey Monastery",
          lngLat: [88.6119, 27.3414],
          description:
            "Known for its scenic location and annual Chaam dances. Follows the Nyingma order.",
          location: "East Sikkim",
          century: "19th Century",
        },
        {
          name: "Dubdi Monastery",
          lngLat: [88.3897, 27.3242],
          description:
            "The first monastery established in Sikkim, located on a hilltop surrounded by forests.",
          location: "West Sikkim",
          century: "17th Century",
        },
      ];
      let map,
        markerLayer,
        userLocationMarker,
        userLocationSource,
        watchId = null,
        isTracking = false,
        currentMapStyle = "satellite",
        baseLayer;

      function initMap() {
        baseLayer = new ol.layer.Tile({
          source: new ol.source.XYZ({
            url: mapStyles[currentMapStyle],
            tileSize: 512,
            crossOrigin: "anonymous",
          }),
        });
        map = new ol.Map({
          target: "map",
          layers: [baseLayer],
          view: new ol.View({
            center: ol.proj.fromLonLat([88.45, 27.5]),
            zoom: 9,
          }),
        });
        markerLayer = new ol.layer.Vector({
          source: new ol.source.Vector(),
        });
        map.addLayer(markerLayer);
        userLocationSource = new ol.source.Vector();
        const userLocationLayer = new ol.layer.Vector({
          source: userLocationSource,
          style: new ol.style.Style({
            image: new ol.style.Circle({
              radius: 8,
              fill: new ol.style.Fill({ color: "#4285F4" }),
              stroke: new ol.style.Stroke({ color: "#FFFFFF", width: 2 }),
            }),
          }),
        });
        map.addLayer(userLocationLayer);
        monasteries.forEach((monastery) => {
          const marker = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.fromLonLat(monastery.lngLat)),
          });
          marker.setStyle(
            new ol.style.Style({
              image: new ol.style.Icon({
                src: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
                scale: 0.05,
                anchor: [0.5, 1],
              }),
            })
          );
          marker.setProperties(monastery);
          markerLayer.getSource().addFeature(marker);
        });
        // Popup
        const popup = new ol.Overlay({
          element: document.createElement("div"),
          positioning: "bottom-center",
          stopEvent: false,
          offset: [0, -15],
        });
        map.addOverlay(popup);
        const popupEl = popup.getElement();
        popupEl.className = "popup-content";
        map.on("click", function (evt) {
          const feature = map.forEachFeatureAtPixel(evt.pixel, (f) => f);
          if (feature && !feature.get("geometry").getType().includes("Point"))
            return;
          if (feature) {
            const props = feature.getProperties();
            popup.setPosition(feature.getGeometry().getCoordinates());
            popupEl.innerHTML = `
                              <div class="popup-header">${props.name}</div>
                              <div class="popup-body">
                                  <p>${props.description}</p>
                                  <p><strong>Location:</strong> ${props.location}</p>
                                  <p><strong>Established:</strong> ${props.century}</p>
                                  <button class="popup-button" onclick="alert('Starting virtual tour of ${props.name}...')">Virtual Tour</button>
                              </div>
                          `;
          } else {
            popup.setPosition(undefined);
          }
        });
        map.on("pointermove", (e) => {
          const hit = map.hasFeatureAtPixel(e.pixel);
          map.getTargetElement().style.cursor = hit ? "pointer" : "";
        });
        map.getView().on("change:resolution", () => {
          document.getElementById("zoom-level").textContent = Math.round(
            map.getView().getZoom()
          );
        });
      }
      initMap();

      // Dropdown change handler
      document
        .getElementById("mapStyleSelect")
        .addEventListener("change", (e) => {
          const style = e.target.value;
          changeMapStyle(style);
          // The dropdown automatically closes when the user selects an option
        });

      function changeMapStyle(style) {
        currentMapStyle = style;
        baseLayer.setSource(
          new ol.source.XYZ({
            url: mapStyles[style],
            tileSize: 512,
            crossOrigin: "anonymous",
          })
        );
      }

      function focusOnMonastery(lngLat, name, element) {
        const view = map.getView();
        view.animate({
          center: ol.proj.fromLonLat(lngLat),
          zoom: 14,
          duration: 1000,
        });
        document
          .querySelectorAll(".monastery-item")
          .forEach((item) => item.classList.remove("active"));
        if (element) element.classList.add("active");
      }
      function zoomIn() {
        map
          .getView()
          .animate({ zoom: map.getView().getZoom() + 1, duration: 300 });
      }
      function zoomOut() {
        map
          .getView()
          .animate({ zoom: map.getView().getZoom() - 1, duration: 300 });
      }
      function resetView() {
        map.getView().animate({
          center: ol.proj.fromLonLat([88.45, 27.5]),
          zoom: 9,
          duration: 1000,
        });
        document
          .querySelectorAll(".monastery-item")
          .forEach((item) => item.classList.remove("active"));
      }
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const btn = document.querySelector(".toggle-sidebar");
        if (sidebar.style.display === "none") {
          sidebar.style.display = "block";
          btn.innerHTML = "‚óÄ";
          btn.style.right = "350px";
        } else {
          sidebar.style.display = "none";
          btn.innerHTML = "‚ñ∂";
          btn.style.right = "20px";
        }
      }
      function locateUser() {
        if (!navigator.geolocation) return alert("Geolocation not supported.");
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            updateUserLocation(pos);
            isTracking = true;
            document.getElementById("locationInfo").classList.add("active");
            if (pos.coords.accuracy < 100) {
              map.getView().animate({
                center: ol.proj.fromLonLat([
                  pos.coords.longitude,
                  pos.coords.latitude,
                ]),
                zoom: 14,
                duration: 1000,
              });
            }
            watchId = navigator.geolocation.watchPosition(
              updateUserLocation, // This correctly passes the 'pos' object
              console.error,
              {
                enableHighAccuracy: true,
                maximumAge: 30000,
                timeout: 27000,
              }
            );
          },
          (error) => {
            document.getElementById("locationDetails").textContent =
              "Error: " + error.message + ". Please enable location services.";
            document.getElementById("locationInfo").classList.add("active");
          }
        );
      }
      function stopLocationTracking() {
        if (watchId !== null) navigator.geolocation.clearWatch(watchId);
        isTracking = false;
        document.getElementById("locationInfo").classList.remove("active");
        if (userLocationMarker) userLocationSource.clear();
      }
      function updateUserLocation(pos) {
        const coords = [pos.coords.longitude, pos.coords.latitude];
        userLocationSource.clear();
        userLocationMarker = new ol.Feature({
          geometry: new ol.geom.Point(ol.proj.fromLonLat(coords)),
        });
        userLocationSource.addFeature(userLocationMarker);
        document.getElementById(
          "locationDetails"
        ).innerHTML = `Lat: ${coords[1].toFixed(6)}<br>Lng: ${coords[0].toFixed(
          6
        )}<br>Acc: ${pos.coords.accuracy.toFixed(2)}m`;
      }
      window.addEventListener("resize", () =>
        setTimeout(() => map && map.updateSize(), 300)
      );
    </script>
  </body>
</html>
